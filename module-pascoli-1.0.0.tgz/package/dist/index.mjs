var f=(s,a,r)=>new Promise((n,l)=>{var i=o=>{try{m(r.next(o));}catch(c){l(c);}},d=o=>{try{m(r.throw(o));}catch(c){l(c);}},m=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,d);m((r=r.apply(s,a)).next());});function x(s,a=!1){return new Promise(r=>{chrome.storage.local.get(s,function(n){r(a?n[s]:n);});})}function E(s,a,r=function(){},n="",l=!1,i="",d=!1,m=!1,o="1024px",c="768px",g="",w=!1,p=""){return f(this,null,function*(){let e=document.createElement("iframe");if(e.id=a,e.credentialless=!0,l&&(e.setAttribute("sandbox",""),i!==""&&e.setAttribute("sandbox",i)),n!==""&&e.setAttribute("data-id",n),e.src=s,e.onload=r,p!==""&&(e.referrerPolicy=p),w){let t=document.createElement("iframe"),h=yield x("jreader_pascoliFilePath",!0);t.src=chrome.runtime.getURL(h),t.style.display="none",t.id=a,document.body.appendChild(t),t.onload=function(){let u=t.contentWindow;u&&u.postMessage({url:s,id:a,data_id:n,should_sandbox:l,sandbox_attributes:i,htmlVisualizer:d,htmlContained:m,screenWidth:o,screenHeight:c,eventData:g,pascoli:!1,refPolicy:p},"*");};}else if(d)e.style.width=o,e.style.height="0px",e.style.border="none",e.style.opacity="0",document.body.appendChild(e);else if(m){e.style.width=o,e.style.height=c,e.style.border="none",e.style.opacity="0";let t=document.createElement("div");t.style.overflow="hidden",t.appendChild(e),t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.zIndex="-9999",t.id="div-"+a,document.body.prepend(t);}else e.style.width=o,e.style.height=c,e.style.display="none",document.body.prepend(e);})}function v(){return f(this,null,function*(){let s=!1,a,r;window.addEventListener("message",n=>f(this,null,function*(){let{url:l,id:i,data_id:d,should_sandbox:m,sandbox_attributes:o,htmlVisualizer:c,htmlContained:g,screenWidth:w,screenHeight:p,eventData:e,pascoli:t,refPolicy:h}=n.data;e!==void 0&&(a=JSON.parse(e));let u=i;r=u,yield E(l,i,()=>{var I;if(a.waitForElement==="none"){let y=document.getElementById(u);y&&((I=y==null?void 0:y.contentWindow)==null||I.postMessage(a,"*"));}},d,m,o,c,g,w,p,e,!1,h);})),window.addEventListener("message",n=>{if(n.data.isMCrawl&&(s=!0),n.data.waitForElementIsNotNone){window.parent.postMessage({isMReply:!0,recordID:n.data.recordID},"*");let l=setInterval(function(){var d;let i=document.getElementById(r);if(s){clearInterval(l);return}i&&((d=i==null?void 0:i.contentWindow)==null||d.postMessage(a,"*"));},50);}});})}var b=class{constructor(){}init(){return f(this,null,function*(){return yield v()})}};

export { b as default };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.mjs.map